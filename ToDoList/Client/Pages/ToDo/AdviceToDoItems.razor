@inject IToDoItemService IToDoItem
@inject ICategoryService ICategory
@page "/to-do-list/advice"
@using ToDoList.Client.Extensions
@attribute [Authorize]

<h3>Advice: To Do List</h3>
<hr />
<ToDoItems ToDoList="@toDoList"/>

@code {
    [CascadingParameter]
    private Task<AuthenticationState> authStateTask { get; set; }

    IEnumerable<ToDoItem> toDoList; 

    protected override async Task OnParametersSetAsync()
    {
        string userId = (await authStateTask).User.GetUserId();
        toDoList = (await IToDoItem.GetToDoItemsAsync(userId))
            .Where(m => !m.IsCompleted)
            .OrderByDescending(m => m.Priority).ThenBy(m => m.Deadline).OrderByDescending(m => m.Complication)
            .ToList();
        foreach (ToDoItem item in toDoList)
            item.Category = await ICategory.GetCategoryAsync(userId, item.CategoryId);
    }

}
